-- 1. Создать и заполнить таблицы лайков и постов.
-- Вариант 9 (финальный)
-- Применим вариант с таблицей типов лайков
-- (применяем к базе vk только этот вариант!)

-- Таблица лайков
DROP TABLE IF EXISTS likes;
CREATE TABLE likes (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id INT UNSIGNED NOT NULL,
  target_id INT UNSIGNED NOT NULL,
  target_type_id INT UNSIGNED NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Таблица типов лайков
DROP TABLE IF EXISTS target_types;
CREATE TABLE target_types (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO target_types (name) VALUES 
  ('messages'),
  ('users'),
  ('media'),
  ('posts');

-- Заполняем лайки
INSERT INTO likes 
  SELECT 
    id, 
    FLOOR(1 + (RAND() * 100)), 
    FLOOR(1 + (RAND() * 100)),
    FLOOR(1 + (RAND() * 4)),
    CURRENT_TIMESTAMP 
  FROM messages;

-- Проверим
SELECT * FROM likes LIMIT 10;

-- Создадим таблицу постов
DROP TABLE IF EXISTS posts;
CREATE TABLE posts (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id INT UNSIGNED NOT NULL,
  community_id INT UNSIGNED,
  head VARCHAR(255),
  body TEXT NOT NULL,
  media_id INT UNSIGNED,
  is_public BOOLEAN DEFAULT TRUE,
  is_archived BOOLEAN DEFAULT FALSE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO `posts` VALUES (1,25,18,'eos','Mystery,\' the Mock Turtle recovered his voice, and, with tears again as she did not like to go among mad people,\' Alice remarked. \'Oh, you can\'t take LESS,\' said the White Rabbit, \'and that\'s the.',60,1,0,'1990-02-20 04:15:15','2018-12-12 21:57:31'),(2,28,5,'dolorem','Queen jumped up on to himself as he came, \'Oh! the Duchess, who seemed to quiver all over with fright. \'Oh, I BEG your pardon!\' cried Alice in a trembling voice:-- \'I passed by his face only, she.',44,1,0,'1975-07-20 01:56:48','2019-05-21 16:04:33'),(3,28,20,'vero','Mouse was bristling all over, and she hastily dried her eyes anxiously fixed on it, for she felt certain it must be removed,\' said the Hatter. \'Does YOUR watch tell you what year it is?\' \'Of course.',8,1,0,'2016-03-30 07:59:39','2005-12-28 19:32:09'),(4,48,9,'magnam','Heads below!\' (a loud crash)--\'Now, who did that?--It was Bill, I fancy--Who\'s to go and live in that soup!\' Alice said to the croquet-ground. The other side of the Queen\'s absence, and were resting.',92,1,0,'2015-04-27 15:06:43','1972-09-04 14:58:56'),(5,37,13,'aliquid','I know?\' said Alice, \'because I\'m not used to read fairy-tales, I fancied that kind of authority among them, called out, \'Sit down, all of them even when they liked, so that by the pope, was soon.',97,1,0,'2006-06-01 20:28:03','1981-09-22 12:40:53'),(6,42,19,'perferendis','Alice, swallowing down her anger as well say,\' added the March Hare moved into the garden at once; but, alas for poor Alice! when she went on again:-- \'You may not have lived much under the hedge..',66,0,0,'1990-08-30 22:19:37','1991-10-12 16:00:13'),(7,26,10,'voluptas','King say in a hurry: a large fan in the distance, sitting sad and lonely on a bough of a muchness\"--did you ever eat a bat?\' when suddenly, thump! thump! down she came upon a neat little house, and.',28,1,0,'2015-03-23 22:56:56','2009-01-17 08:08:10'),(8,19,3,'dicta','Said his father; \'don\'t give yourself airs! Do you think I should understand that better,\' Alice said to herself; \'the March Hare had just upset the week before. \'Oh, I know!\' exclaimed Alice, who.',48,1,0,'1991-01-13 08:44:57','1998-06-04 21:40:20'),(9,46,2,'dicta','Alice, and looking anxiously about as she passed; it was too much of a feather flock together.\"\' \'Only mustard isn\'t a bird,\' Alice remarked. \'Oh, you foolish Alice!\' she answered herself. \'How can.',52,1,0,'1983-10-19 08:25:01','2001-12-29 22:16:54'),(10,20,3,'omnis','SHE, of course,\' the Dodo could not swim. He sent them word I had our Dinah here, I know who I am! But I\'d better take him his fan and the baby--the fire-irons came first; then followed a shower of.',7,1,1,'2007-03-27 00:00:45','2015-02-22 05:00:20'),(11,44,11,'quo','At this the White Rabbit, who said in an angry tone, \'Why, Mary Ann, and be turned out of court! Suppress him! Pinch him! Off with his head!\' she said, without even looking round. \'I\'ll fetch the.',98,1,0,'1997-06-01 05:09:15','1977-09-23 14:40:24'),(12,30,6,'quasi','Hatter, \'when the Queen shouted at the bottom of a book,\' thought Alice to herself, \'I wish the creatures wouldn\'t be so easily offended!\' \'You\'ll get used to do:-- \'How doth the little door about.',32,1,0,'2006-09-18 14:27:21','2015-08-20 19:06:19'),(13,44,4,'accusantium','Besides, SHE\'S she, and I\'m sure I have none, Why, I do hope it\'ll make me larger, it must be shutting up like telescopes: this time the Queen had never been so much frightened to say but \'It.',53,1,0,'2006-06-15 22:33:56','1987-03-22 19:41:23'),(14,22,13,'repellendus','But do cats eat bats? Do cats eat bats? Do cats eat bats, I wonder?\' As she said to herself how this same little sister of hers that you couldn\'t cut off a bit afraid of them!\' \'And who is Dinah, if.',86,1,0,'1980-09-30 09:48:01','1978-01-06 20:40:18'),(15,31,15,'ea','I shall only look up in her life, and had no pictures or conversations?\' So she began looking at Alice the moment they saw the White Rabbit read out, at the top of her ever getting out of sight,.',91,1,0,'1971-10-06 21:49:32','1995-10-02 15:53:26'),(16,19,15,'recusandae','Miss, this here ought to be done, I wonder?\' And here poor Alice in a minute or two. \'They couldn\'t have done that?\' she thought. \'I must go by the White Rabbit, jumping up and picking the daisies,.',39,1,0,'1990-01-15 15:13:12','2018-01-19 00:26:35'),(17,30,17,'consequatur','King said gravely, \'and go on in a low, hurried tone. He looked at it gloomily: then he dipped it into his cup of tea, and looked into its face was quite impossible to say but \'It belongs to the.',4,1,0,'2007-06-04 18:49:21','2012-03-15 16:59:08'),(18,37,14,'odio','Alice, a little house in it about four inches deep and reaching half down the chimney, has he?\' said Alice sharply, for she felt certain it must be the best way to hear her try and say \"Who am I to.',66,1,1,'1983-08-11 05:00:08','1985-01-01 11:19:13'),(19,37,11,'omnis','It sounded an excellent plan, no doubt, and very angrily. \'A knot!\' said Alice, seriously, \'I\'ll have nothing more to come, so she went on to the jury. \'Not yet, not yet!\' the Rabbit hastily.',66,1,0,'1974-05-23 03:02:13','1995-02-03 08:34:24'),(20,18,9,'eos','However, the Multiplication Table doesn\'t signify: let\'s try the effect: the next verse.\' \'But about his toes?\' the Mock Turtle said: \'advance twice, set to work throwing everything within her reach.',97,0,0,'2008-10-18 18:00:42','1993-11-18 18:51:05'),(21,48,2,'et','Queen. \'I haven\'t the slightest idea,\' said the Pigeon; \'but I must be shutting up like a Jack-in-the-box, and up I goes like a mouse, That he met in the middle, wondering how she would have.',83,1,1,'1987-11-25 18:05:53','2018-11-16 06:02:38'),(22,9,13,'numquam','Hatter. \'Does YOUR watch tell you his history,\' As they walked off together. Alice laughed so much at this, but at last turned sulky, and would only say, \'I am older than you, and must know better\';.',87,1,0,'2015-09-19 21:37:29','1993-12-10 00:11:29'),(23,60,19,'qui','ONE.\' \'One, indeed!\' said Alice, a little bit, and said nothing. \'When we were little,\' the Mock Turtle sighed deeply, and drew the back of one flapper across his eyes. \'I wasn\'t asleep,\' he said to.',66,1,0,'1976-05-12 11:23:46','1977-02-08 00:53:56'),(24,59,1,'deleniti','Alice remarked. \'Right, as usual,\' said the Mock Turtle. \'She can\'t explain it,\' said the Rabbit\'s voice; and Alice was a good thing!\' she said to Alice, and her eyes filled with tears running down.',54,1,0,'1983-02-11 16:11:59','1978-05-20 07:04:55'),(25,23,9,'iusto','Besides, SHE\'S she, and I\'m I, and--oh dear, how puzzling it all is! I\'ll try and say \"How doth the little--\"\' and she said to the King, \'that only makes the matter on, What would become of you? I.',12,1,0,'2013-04-09 21:46:33','2008-10-03 07:51:21'),(26,27,6,'ullam','Alice did not dare to laugh; and, as she swam lazily about in a hurry. \'No, I\'ll look first,\' she said, as politely as she leant against a buttercup to rest her chin upon Alice\'s shoulder, and it.',72,1,0,'1972-12-18 06:43:48','1991-08-08 02:08:30'),(27,23,14,'et','Cat said, waving its right paw round, \'lives a March Hare. \'Then it wasn\'t trouble enough hatching the eggs,\' said the Caterpillar took the thimble, saying \'We beg your pardon,\' said Alice.',69,1,0,'2020-05-06 17:12:07','2011-03-27 02:47:25'),(28,32,19,'nihil','Alice. \'It must have been changed several times since then.\' \'What do you know what it was empty: she did not dare to disobey, though she felt a little way out of court! Suppress him! Pinch him! Off.',81,1,0,'2005-02-23 17:48:55','2005-04-21 00:36:20'),(29,4,14,'aut','At last the Dodo could not think of anything else. CHAPTER V. Advice from a Caterpillar The Caterpillar and Alice was just in time to see if there are, nobody attends to them--and you\'ve no idea.',96,1,0,'1978-11-10 00:04:39','1980-03-22 08:44:02'),(30,45,17,'exercitationem','Alice put down the hall. After a while she was ever to get in?\' asked Alice again, for this curious child was very glad she had finished, her sister sat still and said to the Gryphon. \'I\'ve.',67,1,0,'1997-12-09 17:34:54','1980-11-24 10:34:58'),(31,37,18,'hic','Alice went on, \'you throw the--\' \'The lobsters!\' shouted the Queen, tossing her head pressing against the ceiling, and had just succeeded in curving it down into its eyes by this time). \'Don\'t.',75,1,1,'1992-01-20 16:51:31','2015-06-01 03:14:07'),(32,3,4,'placeat','Alice, in a hurry. \'No, I\'ll look first,\' she said, as politely as she ran. \'How surprised he\'ll be when he sneezes: He only does it to the rose-tree, she went on, looking anxiously about as she.',61,1,0,'1985-12-26 07:58:33','1985-12-09 07:02:05'),(33,50,19,'omnis','I\'m sure _I_ shan\'t be beheaded!\' said Alice, seriously, \'I\'ll have nothing more happened, she decided to remain where she was saying, and the Queen said--\' \'Get to your places!\' shouted the Queen,.',19,1,0,'1972-04-29 14:43:55','2004-12-09 05:27:09'),(34,58,6,'et','Pray how did you ever eat a bat?\' when suddenly, thump! thump! down she came up to the Knave of Hearts, carrying the King\'s crown on a crimson velvet cushion; and, last of all her knowledge of.',84,1,0,'1988-05-14 11:42:08','2008-10-17 07:51:44'),(35,27,14,'numquam','Hatter. This piece of it altogether; but after a few yards off. The Cat only grinned a little queer, won\'t you?\' \'Not a bit,\' said the Duchess, \'chop off her unfortunate guests to execution--once.',26,1,0,'1989-10-17 14:42:00','2014-12-25 21:36:39'),(36,13,2,'dolor','ME.\' \'You!\' said the Lory. Alice replied very gravely. \'What else had you to sit down without being seen, when she got to the general conclusion, that wherever you go on? It\'s by far the most.',28,1,0,'1974-02-08 00:34:01','1989-09-25 18:59:36'),(37,1,17,'deserunt','Alice, \'a great girl like you,\' (she might well say that \"I see what this bottle does. I do wonder what I eat\" is the use of this sort in her hands, wondering if anything would EVER happen in a low.',60,0,0,'2020-07-23 16:50:40','1970-11-23 23:00:36'),(38,51,14,'sed','I suppose.\' So she began again. \'I wonder what I eat\" is the same as the soldiers shouted in reply. \'Idiot!\' said the Mouse, turning to the jury. \'Not yet, not yet!\' the Rabbit coming to look.',94,1,0,'2016-12-29 02:01:08','2016-12-07 06:43:37'),(39,15,15,'culpa','ARE OLD, FATHER WILLIAM,\"\' said the Knave, \'I didn\'t write it, and behind it when she was beginning to end,\' said the Queen. \'Never!\' said the Gryphon: and Alice looked down at her own children..',19,1,0,'1985-01-21 19:50:11','2000-01-16 06:17:17'),(40,9,17,'delectus','Mock Turtle\'s Story \'You can\'t think how glad I am in the world you fly, Like a tea-tray in the lock, and to stand on their slates, \'SHE doesn\'t believe there\'s an atom of meaning in it,\' said the.',42,0,0,'1994-11-19 19:23:23','2011-02-27 00:13:12'),(41,55,18,'praesentium','William\'s conduct at first she thought at first was moderate. But the snail replied \"Too far, too far!\" and gave a little bottle on it, and yet it was her dream:-- First, she dreamed of little.',89,1,0,'2002-12-11 16:04:43','1981-11-11 00:38:45'),(42,39,13,'consequatur','Alice. \'Well, I should say what you would seem to put his shoes on. \'--and just take his head sadly. \'Do I look like one, but the Dormouse began in a minute or two. \'They couldn\'t have wanted it.',30,1,0,'1978-02-23 07:49:24','2003-01-13 22:58:53'),(43,9,19,'cupiditate','So she began again: \'Ou est ma chatte?\' which was sitting next to her. The Cat only grinned when it saw mine coming!\' \'How do you know about it, and behind them a railway station.) However, she did.',44,1,0,'1986-12-31 06:24:33','2009-04-07 09:17:40'),(44,18,11,'placeat','I\'d hardly finished the guinea-pigs!\' thought Alice. \'I wonder if I must, I must,\' the King repeated angrily, \'or I\'ll have you got in as well,\' the Hatter asked triumphantly. Alice did not notice.',57,1,0,'1992-09-30 20:19:41','1992-12-20 13:06:19'),(45,15,8,'facere','And will talk in contemptuous tones of the game, the Queen said severely \'Who is this?\' She said the Mock Turtle went on, \'What HAVE you been doing here?\' \'May it please your Majesty,\' said the.',68,1,0,'1998-01-20 03:24:46','1987-03-07 22:54:17'),(46,35,16,'dicta','Alice had no very clear notion how long ago anything had happened.) So she swallowed one of the cupboards as she could. \'No,\' said the Caterpillar; and it was good practice to say it out into the.',87,1,0,'2006-11-23 04:23:39','1978-10-13 15:59:31'),(47,22,18,'culpa','Alice)--\'and perhaps you haven\'t found it advisable--\"\' \'Found WHAT?\' said the Mouse with an anxious look at the Hatter, with an air of great curiosity. \'Soles and eels, of course,\' the Gryphon said.',90,1,0,'1974-09-04 05:18:43','1972-09-27 04:44:10'),(48,23,2,'dolore','Why, she\'ll eat a bat?\' when suddenly, thump! thump! down she came in with a sigh: \'it\'s always tea-time, and we\'ve no time to avoid shrinking away altogether. \'That WAS a curious dream!\' said.',50,1,0,'1988-01-01 06:52:20','1999-11-29 07:51:59'),(49,1,12,'in','The next thing is, to get out again. Suddenly she came upon a low trembling voice, \'Let us get to the seaside once in a whisper.) \'That would be like, \'--for they haven\'t got much evidence YET,\' she.',8,1,0,'2004-06-12 22:36:38','1971-12-25 13:39:59'),(50,23,4,'provident','I have dropped them, I wonder?\' As she said to herself \'It\'s the thing at all. \'But perhaps he can\'t help it,\' said Five, \'and I\'ll tell you what year it is?\' \'Of course you know I\'m mad?\' said.',18,1,0,'1995-04-09 06:27:59','2005-01-21 10:22:45'),(51,54,20,'quo','The Mock Turtle yet?\' \'No,\' said the Duchess, as she ran; but the tops of the conversation. Alice replied, rather shyly, \'I--I hardly know, sir, just at present--at least I mean what I get\" is the.',18,1,1,'2015-05-25 21:14:22','1988-03-25 08:05:19'),(52,14,4,'ab','Alice thought she might find another key on it, (\'which certainly was not otherwise than what you mean,\' the March Hare, who had been found and handed back to the end: then stop.\' These were the.',80,1,0,'1970-01-19 01:00:49','2006-09-09 03:17:23'),(53,51,12,'sequi','What would become of you? I gave her one, they gave him two, You gave us three or more; They all sat down in a melancholy tone: \'it doesn\'t seem to be\"--or if you\'d like it very nice, (it had, in.',53,1,0,'1998-04-30 09:37:34','1990-07-03 19:20:42'),(54,41,11,'aperiam','As a duck with its tongue hanging out of its mouth and began talking again. \'Dinah\'ll miss me very much pleased at having found out a history of the treat. When the Mouse to Alice for protection..',90,1,0,'1983-10-30 03:13:39','1988-09-16 20:03:20'),(55,16,13,'ea','Alice. \'And be quick about it,\' said Alice. \'Nothing WHATEVER?\' persisted the King. \'It began with the words did not notice this last remark, \'it\'s a vegetable. It doesn\'t look like one, but it.',29,1,0,'1988-03-22 23:08:58','2005-08-02 09:51:10'),(56,31,1,'autem','Tarts? The King and Queen of Hearts, and I could say if I know all sorts of things--I can\'t remember half of them--and it belongs to a lobster--\' (Alice began to say to itself \'Then I\'ll go round.',59,1,1,'2013-06-25 23:24:07','1977-06-03 06:49:16'),(57,42,19,'dolores','Mock Turtle\'s heavy sobs. Lastly, she pictured to herself what such an extraordinary ways of living would be four thousand miles down, I think--\' (for, you see, Alice had been to her, still it had.',35,1,0,'1971-09-07 14:55:33','2020-08-22 06:10:39'),(58,17,7,'voluptatem','I think?\' he said to herself, \'whenever I eat or drink under the window, and some \'unimportant.\' Alice could speak again. In a little three-legged table, all made a snatch in the world am I? Ah,.',43,1,0,'1990-11-12 05:05:57','2004-02-21 20:27:37'),(59,26,14,'incidunt','Dormouse shall!\' they both sat silent for a minute, while Alice thought to herself how this same little sister of hers that you have to turn into a graceful zigzag, and was going to shrink any.',93,1,0,'1993-06-20 01:27:55','1977-10-20 09:35:53'),(60,36,1,'voluptatem','I think--\' (she was obliged to have finished,\' said the others. \'We must burn the house till she shook the house, and wondering what to beautify is, I can\'t see you?\' She was a real Turtle.\' These.',93,0,0,'2006-06-30 08:35:22','1986-06-16 08:56:09'),(61,48,14,'laudantium','You know the meaning of it now in sight, hurrying down it. There could be NO mistake about it: it was very provoking to find her in an offended tone, \'Hm! No accounting for tastes! Sing her \"Turtle.',50,1,0,'2014-06-28 08:08:01','1989-05-29 03:21:30'),(62,24,8,'cum','Why, she\'ll eat a little anxiously. \'Yes,\' said Alice, as the large birds complained that they could not stand, and she went on talking: \'Dear, dear! How queer everything is queer to-day.\' Just then.',39,1,0,'1970-03-22 20:25:52','1991-07-07 18:24:10'),(63,53,20,'laudantium','March Hare had just begun \'Well, of all this time. \'I want a clean cup,\' interrupted the Hatter: \'but you could manage it?) \'And what an ignorant little girl she\'ll think me at home! Why, I haven\'t.',2,1,0,'2001-10-29 03:41:35','1984-04-01 17:47:46'),(64,36,3,'vel','The pepper when he finds out who I am! But I\'d better take him his fan and gloves. \'How queer it seems,\' Alice said very politely, \'for I can\'t show it you myself,\' the Mock Turtle. \'Very much.',25,1,0,'1983-03-25 00:02:08','1985-09-25 21:03:06'),(65,50,10,'molestiae','Rabbit, and had to leave it behind?\' She said it to annoy, Because he knows it teases.\' CHORUS. (In which the words don\'t FIT you,\' said the King added in an agony of terror. \'Oh, there goes his.',3,1,0,'1980-06-18 09:20:26','1990-03-17 09:36:59'),(66,13,17,'quia','King hastily said, and went on just as if a dish or kettle had been anything near the door with his nose, you know?\' \'It\'s the Cheshire Cat sitting on a crimson velvet cushion; and, last of all the.',67,1,0,'1970-03-08 18:52:57','1987-11-02 11:03:28'),(67,41,16,'placeat','Because he knows it teases.\' CHORUS. (In which the wretched Hatter trembled so, that Alice had never heard it before,\' said Alice,) and round the court and got behind him, and very soon had to stop.',42,1,1,'1971-05-23 21:12:06','1977-04-21 07:00:34'),(68,22,12,'sit','French mouse, come over with diamonds, and walked off; the Dormouse into the garden. Then she went on, \'if you only kept on puzzling about it while the Dodo had paused as if he thought it must be on.',43,1,0,'1993-09-04 02:13:27','1989-08-11 22:55:43'),(69,19,13,'ad','In another minute there was no \'One, two, three, and away,\' but they were mine before. If I or she fell very slowly, for she could for sneezing. There was a dead silence instantly, and Alice looked.',33,1,0,'1971-05-17 05:26:17','2021-01-27 07:25:33'),(70,18,16,'fugiat','The only things in the distance, and she felt very glad to find that her flamingo was gone across to the beginning of the March Hare meekly replied. \'Yes, but some crumbs must have got into it), and.',48,1,0,'2000-02-02 08:15:01','1993-08-28 22:27:14'),(71,58,9,'explicabo','Alice could hardly hear the name again!\' \'I won\'t indeed!\' said the cook. The King laid his hand upon her face. \'Wake up, Alice dear!\' said her sister; \'Why, what are YOUR shoes done with?\' said the.',64,1,0,'1994-03-06 07:09:35','1988-11-03 03:21:43'),(72,44,20,'delectus','I never knew so much frightened to say \'creatures,\' you see, as she passed; it was looking about for a long sleep you\'ve had!\' \'Oh, I\'ve had such a puzzled expression that she was surprised to find.',73,1,0,'1997-10-02 06:25:06','1998-09-12 04:33:22'),(73,2,11,'at','MINE.\' The Queen turned crimson with fury, and, after folding his arms and legs in all their simple sorrows, and find a thing,\' said the Caterpillar. \'Well, perhaps your feelings may be different,\'.',8,1,0,'2014-09-23 22:17:23','1974-12-17 02:42:27'),(74,43,6,'nihil','I know?\' said Alice, looking down at her feet, for it to the other: the Duchess asked, with another hedgehog, which seemed to quiver all over with fright. \'Oh, I beg your pardon!\' she exclaimed in a.',55,1,0,'1994-11-09 11:47:47','1993-02-25 17:41:35'),(75,58,17,'et','WHAT things?\' said the March Hare. \'He denies it,\' said Alice to herself, as well to introduce some other subject of conversation. \'Are you--are you fond--of--of dogs?\' The Mouse looked at Alice, as.',95,0,0,'1995-07-11 08:33:23','2010-03-24 10:02:09'),(76,3,19,'minima','Alice like the wind, and was going on, as she could guess, she was losing her temper. \'Are you content now?\' said the King, looking round the hall, but they were mine before. If I or she fell past.',34,1,0,'1990-01-17 04:09:53','1993-01-30 00:42:41'),(77,10,6,'nihil','THAT!\' \'Oh, you foolish Alice!\' she answered herself. \'How can you learn lessons in here? Why, there\'s hardly room to grow up again! Let me see: I\'ll give them a railway station.) However, she soon.',30,1,0,'1998-05-25 20:54:09','1999-06-20 03:22:50'),(78,60,18,'vero','But at any rate he might answer questions.--How am I then? Tell me that first, and then, \'we went to school in the middle, wondering how she was quite out of the cupboards as she came upon a time.',92,1,0,'1982-07-03 16:21:55','2001-03-11 20:35:15'),(79,15,4,'voluptatem','Hatter, who turned pale and fidgeted. \'Give your evidence,\' said the Mouse with an air of great dismay, and began talking again. \'Dinah\'ll miss me very much to-night, I should like to be.',50,1,0,'1986-06-21 21:12:09','2001-05-22 12:43:27'),(80,22,11,'et','William the Conqueror.\' (For, with all their simple joys, remembering her own children. \'How should I know?\' said Alice, in a pleased tone. \'Pray don\'t trouble yourself to say it any longer than.',85,1,0,'2012-08-04 02:16:47','2007-03-30 04:53:24'),(81,32,20,'occaecati','First, she dreamed of little Alice and all of them even when they met in the book,\' said the Queen, the royal children, and everybody else. \'Leave off that!\' screamed the Pigeon. \'I can hardly.',75,1,0,'1981-08-10 14:06:15','1987-09-17 13:34:38'),(82,57,16,'est','Ma!\' said the sage, as he said do. Alice looked up, and reduced the answer to it?\' said the Duck. \'Found IT,\' the Mouse was swimming away from her as hard as it went, \'One side of the trees under.',12,1,0,'1974-02-21 00:14:22','2016-02-15 14:11:14'),(83,37,9,'in','I think--\' (she was so ordered about in the sea!\' cried the Mouse, turning to Alice: he had come to an end! \'I wonder what was coming. It was as steady as ever; Yet you turned a corner, \'Oh my ears.',5,1,0,'1975-12-10 08:50:07','1983-08-21 05:56:26'),(84,26,9,'vel','IS the same thing, you know.\' \'Not the same thing as \"I get what I was thinking I should think!\' (Dinah was the White Rabbit with pink eyes ran close by it, and then at the picture.) \'Up, lazy.',64,0,0,'1971-10-28 00:38:54','2019-08-22 14:23:31'),(85,3,4,'est','I\'m not particular as to prevent its undoing itself,) she carried it out to sea!\" But the insolence of his tail. \'As if I must, I must,\' the King said to herself, as usual. \'Come, there\'s half my.',96,1,0,'1991-10-02 12:17:53','1988-03-30 11:26:33'),(86,20,20,'est','Atheling to meet William and offer him the crown. William\'s conduct at first she would get up and said, \'That\'s right, Five! Always lay the blame on others!\' \'YOU\'D better not talk!\' said Five. \'I.',16,1,0,'1972-06-18 14:58:15','1980-10-08 09:58:02'),(87,7,8,'temporibus','King said to herself, \'to be going messages for a great hurry to get hold of its mouth, and addressed her in such confusion that she remained the same thing with you,\' said Alice, who was peeping.',83,1,0,'1983-12-09 22:14:26','1986-02-24 08:56:02'),(88,45,10,'odio','Hatter. \'He won\'t stand beating. Now, if you hold it too long; and that makes you forget to talk. I can\'t tell you how the game began. Alice thought decidedly uncivil. \'But perhaps it was too much.',42,1,0,'1973-06-25 23:45:34','2016-06-25 18:33:55'),(89,23,9,'nesciunt','So she began again: \'Ou est ma chatte?\' which was lit up by wild beasts and other unpleasant things, all because they WOULD go with the Queen, \'and he shall tell you his history,\' As they walked off.',82,0,0,'2000-07-20 00:14:00','1975-11-08 08:39:04'),(90,49,3,'officiis','I know?\' said Alice, as she had finished, her sister sat still and said \'No, never\') \'--so you can find them.\' As she said to herself, \'if one only knew how to get very tired of being all alone.',94,1,0,'1978-06-10 08:52:37','2015-03-01 13:36:05'),(91,17,13,'vitae','Lory and an old woman--but then--always to have changed since her swim in the sea. But they HAVE their tails in their mouths; and the little door: but, alas! either the locks were too large, or the.',95,1,0,'1981-10-16 10:53:04','2014-05-07 03:48:00'),(92,26,9,'modi','Do come back again, and Alice rather unwillingly took the thimble, saying \'We beg your pardon,\' said Alice in a tone of delight, and rushed at the window, and on both sides of it; so, after hunting.',42,1,0,'1999-02-24 07:16:30','1978-11-08 14:03:40'),(93,2,19,'libero','Alice, thinking it was good practice to say than his first remark, \'It was the same thing a bit!\' said the King, going up to her very much at first, the two creatures got so much frightened to say.',37,1,0,'1985-11-16 06:36:24','1979-02-15 19:37:40'),(94,3,18,'et','I can\'t remember,\' said the Mock Turtle repeated thoughtfully. \'I should think you\'ll feel it a violent blow underneath her chin: it had gone. \'Well! I\'ve often seen a rabbit with either a.',88,0,0,'2000-11-25 07:10:26','2015-05-15 13:20:01'),(95,58,18,'omnis','HAVE you been doing here?\' \'May it please your Majesty?\' he asked. \'Begin at the beginning,\' the King added in an undertone, \'important--unimportant--unimportant--important--\' as if he wasn\'t one?\'.',38,1,0,'2012-07-08 13:17:53','1993-06-01 21:14:15'),(96,43,19,'in','Alice, as she leant against a buttercup to rest her chin upon Alice\'s shoulder, and it set to partners--\' \'--change lobsters, and retire in same order,\' continued the Gryphon. \'How the creatures.',65,0,0,'1988-07-02 04:24:27','1985-05-31 03:47:24'),(97,8,4,'dolor','I shall fall right THROUGH the earth! How funny it\'ll seem to see how he did with the Lory, with a great hurry, muttering to himself as he could think of what work it would make with the day of the.',56,0,0,'1973-08-17 21:35:46','1997-09-29 00:15:19'),(98,22,16,'quisquam','Alice, rather alarmed at the stick, and held out its arms folded, quietly smoking a long and a large canvas bag, which tied up at this moment the King, the Queen, who had been running half an hour.',23,1,0,'1991-12-13 04:35:41','2014-02-05 22:48:03'),(99,33,10,'quidem','March Hare said in a low, hurried tone. He looked anxiously over his shoulder as she spoke, but no result seemed to be a Caucus-race.\' \'What IS a Caucus-race?\' said Alice; \'but a grin without a.',2,1,0,'2020-04-08 16:18:12','1970-08-18 02:39:49'),(100,35,4,'qui','Down, down, down. Would the fall was over. However, when they liked, so that it would like the three gardeners, but she did not dare to disobey, though she felt a very fine day!\' said a sleepy voice.',18,1,0,'1985-05-30 07:14:21','1996-01-26 01:33:16');


-- 2. Создать все необходимые внешние ключи и диаграмму отношений.

-- Добавляем внешние ключи в БД vk
-- Для таблицы профилей

-- Смотрим структуру таблицы
DESC profiles;

-- Добавляем внешние ключи
ALTER TABLE profiles
  ADD CONSTRAINT profiles_user_id_fk 
    FOREIGN KEY (user_id) REFERENCES users(id)
      ON DELETE CASCADE;
      
-- Для таблицы сообщений

-- Смотрим структурв таблицы
DESC messages;

-- Добавляем внешние ключи
ALTER TABLE messages
  ADD CONSTRAINT messages_from_user_id_fk 
    FOREIGN KEY (from_user_id) REFERENCES users(id),
  ADD CONSTRAINT messages_to_user_id_fk 
    FOREIGN KEY (to_user_id) REFERENCES users(id);
   
-- Таблица сообществ

ALTER TABLE communities ADD CONSTRAINT communities_owner_id_fk FOREIGN KEY (owner_id) REFERENCES users(id);

-- Таблица пользователей сообществ +
ALTER TABLE communities_users DROP FOREIGN KEY communities_users_user_id_fk;
ALTER TABLE communities_users ADD CONSTRAINT communities_users_community_id_fk FOREIGN KEY (community_id) REFERENCES communities(id) ON DELETE CASCADE;
ALTER TABLE communities_users ADD CONSTRAINT communities_users_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id)ON DELETE CASCADE;   

-- Таблица лайков

ALTER TABLE likes ADD CONSTRAINT likes_target_type_id_fk FOREIGN KEY (target_type_id) REFERENCES target_types(id);  
ALTER TABLE likes ADD CONSTRAINT likes_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);  

-- Таблица media

ALTER TABLE media ADD CONSTRAINT media_media_type_id_fk FOREIGN KEY (media_type_id) REFERENCES media_types(id);  
ALTER TABLE media ADD CONSTRAINT media_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);  

-- Таблица дружбы +

ALTER TABLE friendship ADD CONSTRAINT friendship_friendship_status_id_fk FOREIGN KEY (friendship_status_id) REFERENCES friendship_statuses(id);  
ALTER TABLE friendship ADD CONSTRAINT friendship_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;
ALTER TABLE friendship ADD CONSTRAINT friendship_friend_id_fk FOREIGN KEY (friend_id) REFERENCES users(id) ON DELETE CASCADE;


-- Таблица постов +
ALTER TABLE posts DROP FOREIGN KEY posts_user_id_fk;
ALTER TABLE posts ADD CONSTRAINT posts_community_id_fk FOREIGN KEY (community_id) REFERENCES communities(id) ON DELETE CASCADE;  
ALTER TABLE posts ADD CONSTRAINT posts_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;
ALTER TABLE posts ADD CONSTRAINT posts_media_id_fk FOREIGN KEY (media_id) REFERENCES media(id);

-- Смотрим диаграмму отношений в DBeaver (ERDiagram)

-- 3. Определить кто больше поставил лайков (всего) - мужчины или женщины?

SELECT COUNT(*) FROM likes l ;
SELECT COUNT(*) "likes" FROM likes l where user_id in (SELECT user_id FROM profiles p where gender = 'M')
UNION
SELECT COUNT(*) FROM likes l where user_id in (SELECT user_id FROM profiles p where gender = 'F');

-- 4. Подсчитать общее количество лайков десяти самым молодым пользователям (сколько лайков получили 10 самых молодых пользователей).

SELECT sum(c) FROM (
SELECT user_id, COUNT(*) c FROM 
(SELECT user_id FROM media m
union all
SELECT from_user_id FROM messages m2
union all
SELECT user_id FROM posts p
union all
SELECT target_id FROM likes l where target_type_id = 2) t
GROUP BY user_id ORDER BY c DESC) t2
where user_id in 
(SELECT user_id FROM profiles p where 
	DATEDIFF(DATE(NOW()), birthday)/365.25 < (SELECT max(age) FROM 
			(select DATEDIFF(DATE(NOW()), birthday)/365.25 as age from profiles p order by age LIMIT 10) t3));

-- Тут сначала неправильно понял задание и написал запрос по условию Сколько лайков поставили самые молодые пользователи
SELECT COUNT(*) FROM likes l where user_id in (SELECT user_id FROM profiles p where 
	DATEDIFF(DATE(NOW()), birthday)/365.25 < (SELECT max(age) FROM 
			(select DATEDIFF(DATE(NOW()), birthday)/365.25 as age from profiles p order by age LIMIT 10) t));


-- 5. Найти 10 пользователей, которые проявляют наименьшую активность в использовании социальной сети
-- (критерии активности необходимо определить самостоятельно).
-- Это пользователи, которые  в сумме делают меньше всех лайков, сообщений, медиаконтента и постов.

SELECT user_id, COUNT(*) c FROM  
(SELECT user_id FROM media m
union all
SELECT from_user_id FROM messages m2
union all
SELECT user_id FROM posts p
union all
select user_id FROM likes l) t
GROUP BY user_id ORDER BY c LIMIT 10;	

